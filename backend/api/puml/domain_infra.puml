@startuml
' 스타일
skinparam package {
  BackgroundColor #F8F8FF
  BorderColor #333366
  FontColor #222244
  FontSize 15
}
skinparam rectangle {
  BackgroundColor #F0F8FF
  BorderColor #333366
  FontColor #222244
}
skinparam ArrowColor #336699
skinparam ArrowFontColor #336699
skinparam ArrowFontSize 13

' 서버/엔드포인트
package "NestJS Server" {
  [ChannelService]
}

' 도메인 계층
package "Domain" {
  [Channel (domain model)]
}

' 인프라 계층
package "Infrastructure" {
  package "Persistence" {
    [ChannelRepository (abstract)]
    package "Relational" {
      [RelationalChannelRepository]
      [ChannelEntity]
      [ChannelMapper]
      [PrismaService]
    }
    package "Document" {
      [DocumentChannelRepository]
      [DocumentChannelEntity]
      [DocumentChannelMapper]
      [DocumentDbService]
    }
  }
}

' ORM/DB
package "Prisma ORM" {
  [@prisma/client.Channel]
  [PrismaClient]
  [DB (Postgres)]
}

' Document DB
package "DocumentDB" {
  [DocumentDbClient]
  [DB (Document)]
}

' 관계
[ChannelService] --> [ChannelRepository (abstract)]
[ChannelService] --> [Channel (domain model)]

[ChannelRepository (abstract)] <|-- [RelationalChannelRepository]
[ChannelRepository (abstract)] <|-- [DocumentChannelRepository]

' Relational
[RelationalChannelRepository] --> [ChannelEntity]
[RelationalChannelRepository] --> [ChannelMapper]
[RelationalChannelRepository] --> [PrismaService]
[RelationalChannelRepository] --> [@prisma/client.Channel]
[ChannelMapper] <..> [ChannelEntity] : "Entity 변환"
[ChannelMapper] <..> [@prisma/client.Channel] : "Prisma ↔ Entity"
[ChannelEntity] <..> [Channel (domain model)] : "Entity ↔ Domain"
[PrismaService] --> [PrismaClient]
[PrismaClient] --> [DB (Postgres)]

' Document
[DocumentChannelRepository] --> [DocumentChannelEntity]
[DocumentChannelRepository] --> [DocumentChannelMapper]
[DocumentChannelRepository] --> [DocumentDbService]
[DocumentChannelRepository] --> [DocumentDbClient]
[DocumentChannelMapper] <..> [DocumentChannelEntity] : "Entity 변환"
[DocumentChannelEntity] <..> [Channel (domain model)] : "Entity ↔ Domain"
[DocumentDbService] --> [DocumentDbClient]
[DocumentDbClient] --> [DB (Document)]

@enduml
