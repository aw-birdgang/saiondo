@startuml
!theme plain
skinparam componentStyle uml2
skinparam shadowing false
skinparam roundcorner 15
skinparam monochrome true
skinparam backgroundColor #F9F9F9
skinparam ArrowColor Black
skinparam ArrowFontColor Black
skinparam defaultFontName "Nanum Gothic"

skinparam participant {
  BackgroundColor #E3F2FD
  BorderColor #1976D2
  FontColor #0D47A1
  FontSize 14
  FontStyle bold
}

skinparam actor {
  BackgroundColor #F3E5F5
  BorderColor #7B1FA2
  FontColor #4A148C
  FontSize 14
  FontStyle bold
}

skinparam arrow {
  Color #424242
  FontColor #424242
  FontSize 11
  FontStyle italic
}

skinparam group {
  BackgroundColor #FFF3E0
  BorderColor #F57C00
  FontColor #E65100
  FontSize 12
  FontStyle bold
}

skinparam note {
  BackgroundColor #E8F5E8
  BorderColor #388E3C
  FontColor #1B5E20
  FontSize 10
}

title <color:#1976D2><size:20><b>NestJS + Flutter + Firebase í‘¸ì‹œ ì•Œë¦¼ ì„œë¹„ìŠ¤ íë¦„ë„</b></size></color>

actor "ğŸ‘¤ User" as User
participant " Flutter App" as Flutter
participant "âš™ï¸ NestJS Backend" as Nest
participant "â˜ï¸ Firebase Cloud Messaging\n(FCM)" as Firebase

== ì´ˆê¸° ì„¤ì • ==

User -[#4CAF50]-> Flutter : ì•± ì‹¤í–‰ ë° ë¡œê·¸ì¸
activate Flutter

Flutter -[#2196F3]-> Firebase : ğŸ”§ Firebase.initializeApp()
activate Firebase

Flutter -[#2196F3]-> Firebase : ğŸ”‘ FirebaseMessaging.getToken()
Firebase -[#4CAF50]--> Flutter : ğŸ« FCM Token
deactivate Firebase

note right of Flutter
  <b>FCM í† í° íšë“</b>
  â€¢ ì•±ë³„ ê³ ìœ  ì‹ë³„ì
  â€¢ í‘¸ì‹œ ìˆ˜ì‹ ìš© ì£¼ì†Œ
  â€¢ ì„œë²„ì— ì „ì†¡ í•„ìš”
end note

Flutter -[#FF9800]-> Nest : POST /push/send\n<color:#666666>{token, title, message}</color>
activate Nest

Nest -[#9C27B0]-> Nest : âš™ï¸ Firebase Admin SDK ì´ˆê¸°í™”
note right of Nest
  <b>ì„œë²„ ì´ˆê¸°í™”</b>
  â€¢ ì„œë¹„ìŠ¤ ê³„ì • í‚¤ ë¡œë“œ
  â€¢ Admin SDK ì„¤ì •
  â€¢ í™˜ê²½ ê²€ì¦
end note

Nest -[#F44336]-> Firebase :  send({token, title, message})
activate Firebase

Firebase -[#4CAF50]--> Nest : âœ… ë©”ì‹œì§€ ì „ì†¡ ê²°ê³¼
deactivate Firebase

deactivate Nest
deactivate Flutter

== í‘¸ì‹œ ìˆ˜ì‹  ==

Firebase -[#4CAF50]-> Flutter : ğŸ“¢ Push ì•Œë¦¼ ì „ë‹¬
activate Flutter

note right of Flutter
  <b>í‘¸ì‹œ ìˆ˜ì‹  ì²˜ë¦¬</b>
  â€¢ ë°±ê·¸ë¼ìš´ë“œ/í¬ê·¸ë¼ìš´ë“œ
  â€¢ ì•Œë¦¼ UI í‘œì‹œ
  â€¢ ì‚¬ìš©ì ì¸í„°ë™ì…˜
end note

Flutter -[#4CAF50]-> User : ğŸ¯ ì•Œë¦¼ UI í‘œì‹œ
activate User

note right of User
  <b>ì‚¬ìš©ì ê²½í—˜</b>
  â€¢ ì•Œë¦¼ ë°°ë„ˆ í‘œì‹œ
  â€¢ ì†Œë¦¬/ì§„ë™
  â€¢ íƒ­ ì‹œ ì•± ì‹¤í–‰
end note

deactivate User
deactivate Flutter
deactivate Firebase

@enduml
