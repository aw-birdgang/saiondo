@startuml
!theme plain
skinparam componentStyle uml2
skinparam shadowing false
skinparam roundcorner 15
skinparam monochrome true
skinparam backgroundColor #F9F9F9
skinparam ArrowColor Black
skinparam ArrowFontColor Black
skinparam defaultFontName "Nanum Gothic"

title Saiondo Backend - ë¬¸ì„œ ì—…ë¡œë“œ & ë²¡í„°í™” íë¦„ í¬í•¨

skinparam defaultFontSize 16
skinparam package {
  BackgroundColor #FFFFFF
  BorderColor #8888AA
  FontColor #222244
}
skinparam cloud {
  BackgroundColor #F8F8FF
  BorderColor #8888AA
  FontColor #222244
}
skinparam database {
  BackgroundColor #FFFFF0
  BorderColor #888866
  FontColor #222244
}
skinparam storage {
  BackgroundColor #F8FFF8
  BorderColor #66AA66
  FontColor #222244
}
skinparam node {
  BackgroundColor #F8F8FF
  BorderColor #8888AA
  FontColor #222244
}

' === Frontend ===
package "Frontend (Flutter)" {
  [ğŸ“± Flutter App] as flutter #LightSkyBlue
}

' === AWS Cloud ===
cloud "AWS Cloud" as aws {
  node "NestJS Backend\n(EC2/ECS)" as backend #LightYellow {
    [REST API\n(NestJS Controller)] as api #LightYellow
    [Domain Services] as services #LightYellow
    [LLM Proxy] as llmproxy #LightYellow
    [Vector Task Dispatcher] as vectordispatch #LightYellow
    [Web3 Service] as web3svc #LightYellow
    [Logger/Monitoring] as logger #LightYellow

    api -down-> services : Service í˜¸ì¶œ
    services -down-> vectordispatch : ë¬¸ì„œ ë²¡í„°í™” ìš”ì²­
    services -down-> llmproxy : LLM ì‘ë‹µ í˜¸ì¶œ
    api -down-> logger : ë¡œê¹…
  }

  storage "Amazon S3\n(ë¬¸ì„œ ì €ì¥)" as s3 #Azure
  database "Amazon RDS\n(PostgreSQL)" as db #LightGoldenRodYellow

  backend --> db : ORM (Prisma)
  api --> s3 : ë¬¸ì„œ ì—…ë¡œë“œ (multipart/form-data)
}

' === LLM Server ===
package "LLM Server (FastAPI + LangChain)" {
  [FastAPI + LangChain] as fastapi #Thistle
  [OpenAI Provider] as openai #White
  [Claude Provider] as claude #White
  [Provider Base] as base #White
  [Logger/Tracing] as tracing #White

  storage "Vector Store\n(Qdrant, Chroma ë“±)" as vectorstore #HoneyDew

  fastapi -down-> base : provider íŒ¨í„´
  base -down-> openai
  base -down-> claude
  fastapi -down-> tracing : LangChain Tracing
  fastapi -down-> vectorstore : ì„ë² ë”© + ì €ì¥
}

cloud "Blockchain\n(Ethereum, Klaytn ë“±)" as chain #MintCream

' === ì‹¤ì„  ë°ì´í„° íë¦„ ===
flutter -down-> api : ë¬¸ì„œ ì—…ë¡œë“œ ìš”ì²­
api -down-> s3 : S3ì— ë¬¸ì„œ ì €ì¥
vectordispatch -down-> fastapi : ë¬¸ì„œ ë©”íƒ€ + URL ì „ë‹¬
fastapi -down-> vectorstore : ìœ ì‚¬ ë¬¸ì„œ ì„ë² ë”© ë° ì €ì¥

' === ê¸°ì¡´ LLM ì§ˆì˜ íë¦„ ===
flutter -down-> api : ì‚¬ìš©ì ì§ˆë¬¸
llmproxy -down-> fastapi : LLM ì§ˆì˜
fastapi -down-> vectorstore : ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
fastapi -down-> tracing : í˜¸ì¶œ ì¶”ì 

' === Web3 ===
web3svc -down-> chain : RPC/HTTP
flutter ..right..> chain : ì§ì ‘ Web3 ì—°ë™ (ì„ íƒ)

@enduml
