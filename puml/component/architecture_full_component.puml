@startuml
!theme plain
title SAIONDO - Full Stack Architecture (AWS + Web3 + LLM + Vector Store)

' === ìŠ¤íƒ€ì¼ ì„¤ì • ===
skinparam defaultFontSize 12
skinparam defaultFontName Arial

' íŒ¨í‚¤ì§€ ìŠ¤íƒ€ì¼
skinparam package {
  BackgroundColor #F8F9FA
  BorderColor #6C757D
  FontColor #495057
}

' í´ë¼ìš°ë“œ ìŠ¤íƒ€ì¼
skinparam cloud {
  BackgroundColor #E3F2FD
  BorderColor #2196F3
  FontColor #1565C0
}

' ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤íƒ€ì¼
skinparam database {
  BackgroundColor #FFF3E0
  BorderColor #FF9800
  FontColor #E65100
}

' ìŠ¤í† ë¦¬ì§€ ìŠ¤íƒ€ì¼
skinparam storage {
  BackgroundColor #E8F5E8
  BorderColor #4CAF50
  FontColor #2E7D32
}

' ë…¸ë“œ ìŠ¤íƒ€ì¼
skinparam node {
  BackgroundColor #F3E5F5
  BorderColor #9C27B0
  FontColor #6A1B9A
}

' í ìŠ¤íƒ€ì¼
skinparam queue {
  BackgroundColor #FFEBEE
  BorderColor #F44336
  FontColor #C62828
}

' === Frontend ===
package "ğŸ“± Frontend (Flutter)" as frontend {
  [Presentation Layer] as presentation #E3F2FD
  [Domain Layer] as domain #E8F5E8
  [Data Layer] as data #FFF3E0
  [DI Container] as di #F3E5F5

  presentation -down-> domain : UseCase í˜¸ì¶œ
  domain -down-> data : Repository êµ¬í˜„ì²´
  di -right-> presentation : Store ì£¼ì…
  di -right-> domain : UseCase ì£¼ì…
  di -right-> data : Repository ì£¼ì…
}

' === AWS Cloud ===
cloud "â˜ï¸ AWS Cloud" as aws {
  ' === Load Balancer Layer ===
  [Application Load Balancer] as alb #E3F2FD

  ' === Backend Services ===
  node "ğŸš€ NestJS Backend (ECS)" as backend {
    [REST API Controllers] as api #E3F2FD
    [WebSocket Gateway] as ws #E3F2FD
    [Domain Services] as services #E8F5E8
    [LLM Proxy Service] as llm_proxy #E8F5E8
    [Web3 Service] as web3_service #E8F5E8
    [Prisma ORM] as prisma #FFF3E0
    [Redis Service] as redis_service #FFF3E0

    api -down-> services : Service í˜¸ì¶œ
    ws -down-> services : ì‹¤ì‹œê°„ ì²˜ë¦¬
    services -down-> llm_proxy : LLM ìš”ì²­
    services -down-> web3_service : Web3 ì—°ë™
    services -down-> prisma : DB ì ‘ê·¼
    services -down-> redis_service : ìºì‹±
  }

  ' === LLM Server ===
  node "ğŸ¤– LLM Server (ECS)" as llm_server {
    [Provider Base] as provider_base #E3F2FD
    [OpenAI Provider] as openai #E3F2FD
    [Claude Provider] as claude #E3F2FD
    [Chat Service] as chat_service #E8F5E8
    [Analysis Service] as analysis_service #E8F5E8
    [LangSmith Tracing] as tracing #FFEBEE

    provider_base -down-> openai : Provider íŒ¨í„´
    provider_base -down-> claude : Provider íŒ¨í„´
    openai -down-> chat_service : AI ì²˜ë¦¬
    claude -down-> analysis_service : AI ì²˜ë¦¬
    chat_service -down-> tracing : ì¶”ì 
  }

  ' === Infrastructure Management ===
  node "ï¿½ï¿½ï¸ Infrastructure (Terraform)" as infra {
    [VPC + Subnets] as vpc #E3F2FD
    [ECS Cluster] as ecs #E8F5E8
    [ECR Registry] as ecr #FFF3E0
    [CodePipeline] as pipeline #FFEBEE
    [Security Groups] as sg #FFEBEE

    vpc -down-> ecs : ë„¤íŠ¸ì›Œí‚¹
    pipeline -down-> ecr : ì´ë¯¸ì§€ í‘¸ì‹œ
    pipeline -down-> ecs : ë°°í¬
    sg -down-> alb : ALB ë³´ì•ˆ
    sg -down-> backend : Backend ë³´ì•ˆ
    sg -down-> llm_server : LLM ë³´ì•ˆ
  }

  ' === Data Storage ===
  database "ï¿½ï¿½ï¸ RDS (PostgreSQL)" as rds
  queue "âš¡ ElastiCache (Redis)" as redis
  storage "ğŸ” Vector Store" as vector_store

  backend --> rds : Prisma ORM
  backend --> redis : ìºì‹±/ì„¸ì…˜
  llm_server --> vector_store : ë²¡í„° ê²€ìƒ‰
}

' === Blockchain ===
cloud "â›“ï¸ Blockchain Network" as blockchain {
  [Ethereum Mainnet] as eth #E3F2FD
  [Klaytn Network] as klaytn #E8F5E8
}

' === Web3 Development ===
package "ï¿½ï¿½ Web3 Development (Hardhat)" as web3_dev {
  [Smart Contracts] as contracts #E3F2FD
  [Deploy Scripts] as deploy #E8F5E8
  [Test Suite] as tests #FFF3E0

  contracts -down-> deploy : ë°°í¬
  contracts -down-> tests : í…ŒìŠ¤íŠ¸
}

' === ì£¼ìš” ë°ì´í„° íë¦„ ===
frontend -down-> alb : HTTPS/WebSocket
alb -down-> backend : ë¡œë“œë°¸ëŸ°ì‹±
backend -down-> llm_server : ë‚´ë¶€ í†µì‹  (Service Discovery)
llm_server -right-> vector_store : ë²¡í„° ê²€ìƒ‰
backend -down-> blockchain : Web3 ì—°ë™
web3_dev -down-> blockchain : ì»¨íŠ¸ë™íŠ¸ ë°°í¬

' === ìºì‹± ë° ì„±ëŠ¥ ===
redis -up-> backend : ì‹¤ì‹œê°„ ë°ì´í„°
vector_store -up-> llm_server : ìœ ì‚¬ë„ ê²€ìƒ‰

@enduml
