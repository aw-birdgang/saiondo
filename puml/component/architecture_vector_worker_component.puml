@startuml
!theme plain
title Saiondo Vector Ingestion Flow (NestJS + Bull + Worker + LangChain)

skinparam defaultFontSize 16
skinparam package {
  BackgroundColor #FFFFFF
  BorderColor #8888AA
  FontColor #222244
}
skinparam cloud {
  BackgroundColor #F8F8FF
  BorderColor #8888AA
  FontColor #222244
}
skinparam database {
  BackgroundColor #FFFFF0
  BorderColor #888866
  FontColor #222244
}
skinparam storage {
  BackgroundColor #F8FFF8
  BorderColor #66AA66
  FontColor #222244
}
skinparam queue {
  BackgroundColor #FFF8FF
  BorderColor #AA66AA
  FontColor #222244
}
skinparam node {
  BackgroundColor #F8F8FF
  BorderColor #8888AA
  FontColor #222244
}

' === Frontend ===
package "Frontend (Flutter)" {
  [ğŸ“± Flutter App] as flutter #LightSkyBlue
}

' === AWS Cloud / NestJS ===
cloud "NestJS Backend (EC2/ECS)" as nest {
  node "Main Backend" as backend #LightYellow {
    [REST API] as api
    [Bull Producer] as bullprod
    [Logger] as logger
  }

  storage "Amazon S3" as s3 #Azure
  queue "Redis + Bull Queue" as bullq #Lavender
}

' === Vector Worker ===
node "Vector Worker (NestJS ëª¨ë“ˆ)" as worker #MintCream {
  [Bull Consumer] as bullcon
  [S3 Downloader] as s3down
  [HTTP Client] as httpclient
}

' === LLM Server (FastAPI + LangChain) ===
package "LLM Server" {
  [FastAPI + LangChain] as fastapi #Thistle
  storage "Vector Store\n(Qdrant, Chroma)" as vectorstore #HoneyDew
}

' === ë°ì´í„° íë¦„ ===
flutter -down-> api : ë¬¸ì„œ ì—…ë¡œë“œ ìš”ì²­
api -down-> s3 : S3ì— ë¬¸ì„œ ì €ì¥
api -down-> bullprod : ë²¡í„°í™” íƒœìŠ¤í¬ ìƒì„±
bullprod --> bullq : ë¬¸ì„œ URL í¬í•¨ íƒœìŠ¤í¬ ë°œí–‰

bullq --> bullcon : íƒœìŠ¤í¬ ì†Œë¹„
bullcon -down-> s3down : S3ì—ì„œ ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ
s3down -down-> httpclient : LLM Serverì— ì „ì†¡
httpclient -down-> fastapi : POST /ingest (ë¬¸ì„œ ì „ì†¡)
fastapi -down-> vectorstore : ë²¡í„° ì €ì¥ (ì„ë² ë”© ìˆ˜í–‰)

api -right-> logger : ì—…ë¡œë“œ/íƒœìŠ¤í¬ ê¸°ë¡

@enduml
